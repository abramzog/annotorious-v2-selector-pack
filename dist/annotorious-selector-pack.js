/*! For license information please see annotorious-selector-pack.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Annotorious=e():(t.Annotorious=t.Annotorious||{},t.Annotorious.SelectorPack=e())}(self,(()=>(()=>{var t={94:t=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}t.exports=function t(n,r){if(n===r)return!0;if(n&&r&&"object"==e(n)&&"object"==e(r)){if(n.constructor!==r.constructor)return!1;var o,i,u;if(Array.isArray(n)){if((o=n.length)!=r.length)return!1;for(i=o;0!=i--;)if(!t(n[i],r[i]))return!1;return!0}if(n.constructor===RegExp)return n.source===r.source&&n.flags===r.flags;if(n.valueOf!==Object.prototype.valueOf)return n.valueOf()===r.valueOf();if(n.toString!==Object.prototype.toString)return n.toString()===r.toString();if((o=(u=Object.keys(n)).length)!==Object.keys(r).length)return!1;for(i=o;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,u[i]))return!1;for(i=o;0!=i--;){var a=u[i];if(!t(n[a],r[a]))return!1}return!0}return n!=n&&r!=r}},773:t=>{function e(){}e.prototype={on:function(t,e,n){var r=this.e||(this.e={});return(r[t]||(r[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var r=this;function o(){r.off(t,o),e.apply(n,arguments)}return o._=e,this.on(t,o,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),r=0,o=n.length;r<o;r++)n[r].fn.apply(n[r].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),r=n[t],o=[];if(r&&e)for(var i=0,u=r.length;i<u;i++)r[i].fn!==e&&r[i].fn._!==e&&o.push(r[i]);return o.length?n[t]=o:delete n[t],this}},t.exports=e,t.exports.TinyEmitter=e}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var r={};return(()=>{"use strict";n.d(r,{default:()=>_r});var t,e=n(773),o=n.n(e),i="http://www.w3.org/2000/svg",u=new Uint8Array(16);function a(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(u)}const c=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var l=[],s=0;s<256;++s)l.push((s+256).toString(16).substr(1));const f=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(l[t[e+0]]+l[t[e+1]]+l[t[e+2]]+l[t[e+3]]+"-"+l[t[e+4]]+l[t[e+5]]+"-"+l[t[e+6]]+l[t[e+7]]+"-"+l[t[e+8]]+l[t[e+9]]+"-"+l[t[e+10]]+l[t[e+11]]+l[t[e+12]]+l[t[e+13]]+l[t[e+14]]+l[t[e+15]]).toLowerCase();if(!function(t){return"string"==typeof t&&c.test(t)}(n))throw TypeError("Stringified UUID is invalid");return n},p=function(t,e,n){var r=(t=t||{}).random||(t.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){n=n||0;for(var o=0;o<16;++o)e[n+o]=r[o];return e}return f(r)};var y=n(94),b=n.n(y);function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function m(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){g(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,w(r.key),r)}}function g(t,e,n){return(e=w(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function w(t){var e=function(t,e){if("object"!==d(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===d(e)?e:String(e)}var S=function(){function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),g(this,"clone",(function(e,n){return new t(m(m({},r.underlying),e),m(m({},r.opts),n))})),g(this,"selector",(function(t){var e=r.underlying.target;if(e.selector)return(Array.isArray(e.selector)?e.selector:[e.selector]).find((function(e){return e.type===t}))})),this.underlying=e,this.opts=n}var e,n;return e=t,(n=[{key:"isEqual",value:function(t){return"Annotation"===(null==t?void 0:t.type)&&(this.underlying===t.underlying||!(!this.underlying.id||!t.underlying.id)&&b()(this.underlying,t.underlying))}},{key:"readOnly",get:function(){var t;return null===(t=this.opts)||void 0===t?void 0:t.readOnly}},{key:"id",get:function(){return this.underlying.id}},{key:"context",get:function(){return this.underlying["@context"]}},{key:"type",get:function(){return this.underlying.type}},{key:"motivation",get:function(){return this.underlying.motivation}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]},set:function(t){this.underlying.body=t}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"quote",get:function(){var t;return null===(t=this.selector("TextQuoteSelector"))||void 0===t?void 0:t.exact}},{key:"start",get:function(){var t;return null===(t=this.selector("TextPositionSelector"))||void 0===t?void 0:t.start}},{key:"end",get:function(){var t;return null===(t=this.selector("TextPositionSelector"))||void 0===t?void 0:t.end}}])&&v(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function j(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function P(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?j(Object(n),!0).forEach((function(e){A(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function E(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,x(r.key),r)}}function A(t,e,n){return(e=x(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function x(t){var e=function(t,e){if("object"!==O(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==O(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===O(e)?e:String(e)}g(S,"create",(function(t){var e={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:"#".concat(p()),body:[]};return new S(m(m({},e),t))}));var k=function(){function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),A(this,"clone",(function(e){var n=new t;return n.underlying=JSON.parse(JSON.stringify(r.underlying)),e&&(n.underlying=P(P({},n.underlying),e)),n})),A(this,"selector",(function(t){var e=r.underlying.target;if(e.selector)return(Array.isArray(e.selector)?e.selector:[e.selector]).find((function(e){return e.type===t}))})),A(this,"toAnnotation",(function(){var t=Object.assign({},r.underlying,{type:"Annotation",id:"#".concat(p())});return new S(t)})),this.underlying={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Selection",body:n||[],target:e}}var e,n;return e=t,(n=[{key:"context",get:function(){return this.underlying["@context"]}},{key:"type",get:function(){return this.underlying.type}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"isEqual",value:function(t){return!!t&&b()(this.underlying,t.underlying)}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]}},{key:"quote",get:function(){var t;return null===(t=this.selector("TextQuoteSelector"))||void 0===t?void 0:t.exact}},{key:"isSelection",get:function(){return!0}}])&&E(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function M(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function R(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,B(r.key),r)}}function _(t,e,n){return e&&R(t.prototype,e),n&&R(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function T(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&G(t,e)}function G(t,e){return G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},G(t,e)}function D(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=L(t);if(e){var o=L(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"===C(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return N(t)}(this,n)}}function N(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function L(t){return L=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},L(t)}function H(t,e,n){return(e=B(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function B(t){var e=function(t,e){if("object"!==C(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==C(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===C(e)?e:String(e)}var U="An implementation is missing",X="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,q=function(t){T(n,t);var e=D(n);function n(t,r,o){var u;M(this,n),H(N(u=e.call(this)),"enableResponsive",(function(){window.ResizeObserver&&(u.resizeObserver=new ResizeObserver((function(){var t=u.svg.getBoundingClientRect(),e=u.svg.viewBox.baseVal,n=e.width,r=e.height;u.scale=Math.max(n/t.width,r/t.height),u.onScaleChanged&&u.onScaleChanged(u.scale)})),u.resizeObserver.observe(u.svg.parentNode))})),H(N(u),"getSVGPoint",(function(t){var e=u.svg.createSVGPoint();if(X){var n=u.svg.getBoundingClientRect(),r=t.clientX-n.x,o=t.clientY-n.y,i=u.svg.getBoundingClientRect(),a=i.left,c=i.top;return e.x=r+a,e.y=o+c,e.matrixTransform(u.g.getScreenCTM().inverse())}return e.x=t.offsetX,e.y=t.offsetY,e.matrixTransform(u.g.getCTM().inverse())})),H(N(u),"drawHandle",(function(t,e){var n=document.createElementNS(i,"g");n.setAttribute("class","a9s-handle");var r=document.createElementNS(i,"g"),o=function(n){var r=document.createElementNS(i,"circle");return r.setAttribute("cx",t),r.setAttribute("cy",e),r.setAttribute("r",n),r.setAttribute("transform-origin","".concat(t," ").concat(e)),r},a=u.config.handleRadius||6,c=o(a);c.setAttribute("class","a9s-handle-inner");var l=o(a+1);return l.setAttribute("class","a9s-handle-outer"),r.appendChild(l),r.appendChild(c),n.appendChild(r),n})),H(N(u),"setHandleXY",(function(t,e,n){var r=t.querySelector(".a9s-handle-inner");r.setAttribute("cx",e),r.setAttribute("cy",n),r.setAttribute("transform-origin","".concat(e," ").concat(n));var o=t.querySelector(".a9s-handle-outer");o.setAttribute("cx",e),o.setAttribute("cy",n),o.setAttribute("transform-origin","".concat(e," ").concat(n))})),H(N(u),"getHandleXY",(function(t){var e=t.querySelector(".a9s-handle-outer");return{x:parseFloat(e.getAttribute("cx")),y:parseFloat(e.getAttribute("cy"))}})),H(N(u),"scaleHandle",(function(t){var e=t.querySelector(".a9s-handle-inner"),n=t.querySelector(".a9s-handle-outer"),r=u.scale*(u.config.handleRadius||6);e.setAttribute("r",r),n.setAttribute("r",r)})),u.svg=t.closest("svg"),u.g=t,u.config=r,u.env=o,u.scale=1;var a=o.image;return(a instanceof Element||a instanceof HTMLDocument)&&u.enableResponsive(),u}return _(n,[{key:"destroy",value:function(){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=null}}]),n}(o()),Y=function(t){T(n,t);var e=D(n);function n(t,r,o){var i;return M(this,n),H(N(i=e.call(this,t,r,o)),"attachListeners",(function(t){var e=t.mouseMove,n=t.mouseUp,r=t.dblClick;e&&(i.mouseMove=function(t){var n=i.getSVGPoint(t),r=n.x,o=n.y;i.started||(i.emit("startSelection",{x:r,y:o}),i.started=!0),e(r,o,t)},i.svg.addEventListener("mousemove",i.mouseMove)),n&&(i.mouseUp=function(t){if(0===t.button){var e=i.getSVGPoint(t),r=e.x,o=e.y;n(r,o,t)}},document.addEventListener("mouseup",i.mouseUp)),r&&(i.dblClick=function(t){var e=i.getSVGPoint(t),n=e.x,o=e.y;r(n,o,t)},document.addEventListener("dblclick",i.dblClick))})),H(N(i),"detachListeners",(function(){i.mouseMove&&i.svg.removeEventListener("mousemove",i.mouseMove),i.mouseUp&&document.removeEventListener("mouseup",i.mouseUp),i.dblClick&&document.removeEventListener("dblclick",i.dblClick)})),H(N(i),"start",(function(t,e){var n=i.getSVGPoint(t),r=n.x,o=n.y;i.startDrawing(r,o,e,t)})),H(N(i),"startDrawing",(function(t){throw new Error(U)})),H(N(i),"createEditableShape",(function(t,e){throw new Error(U)})),i.started=!1,i}return _(n,[{key:"isDrawing",get:function(){throw new Error(U)}}]),n}(q);function V(t){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V(t)}function F(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$(r.key),r)}}function z(t,e){return z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},z(t,e)}function I(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function W(t){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},W(t)}function $(t){var e=function(t,e){if("object"!==V(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==V(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===V(e)?e:String(e)}Y.supports=function(t){throw new Error(U)};var Z="An implementation is missing",K=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&z(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=W(r);if(o){var n=W(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===V(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return I(t)}(this,t)});function u(t,e,n,r){var o,a,c,l;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),a=I(o=i.call(this,e,n,r)),l=function(t){throw new Error(Z)},(c=$(c="updateState"))in a?Object.defineProperty(a,c,{value:l,enumerable:!0,configurable:!0,writable:!0}):a[c]=l,o.annotation=t,o}return e=u,(n=[{key:"element",get:function(){throw new Error(Z)}}])&&F(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(q);function J(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Q=function(t,e){var n=t.selector("FragmentSelector");if(null!=n&&n.conformsTo.startsWith("http://www.w3.org/TR/media-frags")){var r=n.value,o=r.includes(":")?r.substring(r.indexOf("=")+1,r.indexOf(":")):"pixel",i=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,u,a=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return J(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}((r.includes(":")?r.substring(r.indexOf(":")+1):r.substring(r.indexOf("=")+1)).split(",").map(parseFloat),4),u=i[0],a=i[1],c=i[2],l=i[3];return"percent"===o.toLowerCase()&&(u=u*e.naturalWidth/100,a=a*e.naturalHeight/100,c=c*e.naturalWidth/100,l=l*e.naturalHeight/100),{x:u,y:a,w:c,h:l}}};function tt(t){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tt(t)}function et(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function nt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?et(Object(n),!0).forEach((function(e){rt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function rt(t,e,n){return(e=function(t){var e=function(t,e){if("object"!==tt(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==tt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===tt(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ot=function(t,e,n,r){return nt(nt({},function(t,e,n,r,o,i){return"percent"===(null==i?void 0:i.toLowerCase())?function(t,e,n,r,o){var i=t/o.naturalWidth*100,u=e/o.naturalHeight*100,a=0/o.naturalWidth*100,c=0/o.naturalHeight*100;return{source:o.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:"xywh=percent:".concat(i,",").concat(u,",").concat(a,",").concat(c)}}}(t,e,0,0,o):function(t,e,n,r,o){return{source:null==o?void 0:o.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:"xywh=pixel:".concat(t,",").concat(e,",").concat(0,",").concat(0)}}}(t,e,0,0,o)}(t,e,0,0,n,r)),{},{renderedVia:{name:"point"}})};function it(t){return it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},it(t)}function ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,pt(r.key),r)}}function at(){return at="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=st(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},at.apply(this,arguments)}function ct(t,e){return ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ct(t,e)}function lt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function st(t){return st=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},st(t)}function ft(t,e,n){return(e=pt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pt(t){var e=function(t,e){if("object"!==it(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==it(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===it(e)?e:String(e)}var yt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ct(t,e)}(a,t);var e,n,r,o,u=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=st(r);if(o){var n=st(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===it(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return lt(t)}(this,t)});function a(t,e,n,r){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),ft(lt(o=u.call(this,t,e,n,r)),"onScaleChanged",(function(){return o.scaleHandle(o.point)})),ft(lt(o),"onGrab",(function(){o.isGrabbed=!0})),ft(lt(o),"onMouseMove",(function(t){if(0===t.button&&o.isGrabbed){var e=o.getSVGPoint(t),n=e.x,r=e.y;o.setHandleXY(o.point,n,r);var i=ot(n,r,o.env.image,o.config.fragmentUnit);o.emit("update",i)}})),ft(lt(o),"onMouseUp",(function(){o.isGrabbed=!1})),ft(lt(o),"updateState",(function(t){var e=Q(t,o.env.image),n=e.x,r=e.y;o.setHandleXY(o.point,n,r)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp);var c=Q(t,r.image),l=c.x,s=c.y;return o.container=document.createElementNS(i,"g"),o.elementGroup=document.createElementNS(i,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.point=o.drawHandle(l,s),o.point.addEventListener("mousedown",o.onGrab),o.elementGroup.appendChild(o.point),o.container.appendChild(o.elementGroup),e.appendChild(o.container),o.isGrabbed=!1,o}return e=a,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.svg.removeEventListener("mousemove",this.onMouseMove),this.svg.removeEventListener("mouseup",this.onMouseUp),this.container.parentNode.removeChild(this.container),at(st(a.prototype),"destroy",this).call(this)}}])&&ut(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(K);function bt(t){return bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bt(t)}function dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,wt(r.key),r)}}function ht(t,e){return ht=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ht(t,e)}function mt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function vt(t){return vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vt(t)}function gt(t,e,n){return(e=wt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function wt(t){var e=function(t,e){if("object"!==bt(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==bt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===bt(e)?e:String(e)}var St=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ht(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=vt(r);if(o){var n=vt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===bt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return mt(t)}(this,t)});function u(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),gt(mt(r=i.call(this,t,e,n)),"startDrawing",(function(t,e,n,o){var i,u=null===(i=o.target.closest(".a9s-annotation"))||void 0===i?void 0:i.annotation;if(u&&function(t){var e;return"point"===(null===(e=t.target.renderedVia)||void 0===e?void 0:e.name)}(u))r.emit("cancel");else{var a=r.drawHandle(t,e);r.scaleHandle(a),r.g.appendChild(a),a.annotation=new k(ot(t,e,r.env.image,r.config.fragmentUnit)),r.emit("complete",a)}})),gt(mt(r),"stop",(function(){})),gt(mt(r),"createEditableShape",(function(t){return new yt(t,r.g,r.config,r.env)})),r}return e=u,(n=[{key:"isDrawing",get:function(){return!1}}])&&dt(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(Y);St.identifier="point",St.supports=function(t){return!1};var Ot=function(t){var e=function(t){Array.from(t.attributes).forEach((function(e){e.name.startsWith("on")&&t.removeAttribute(e.name)}))},n=t.getElementsByTagName("script");return Array.from(n).reverse().forEach((function(t){return t.parentNode.removeChild(t)})),e(t),Array.from(t.querySelectorAll("*")).forEach(e),t},jt=function(t){var e,n,r=t.selector("SvgSelector");if(r){var o=new DOMParser,u=r.value,a=o.parseFromString(u,"image/svg+xml"),c=a.lookupPrefix(i),l=a.lookupNamespaceURI(null);return c||l?Ot(a).firstChild:Ot((e=a,n=(new XMLSerializer).serializeToString(e.documentElement).replace("<svg>",'<svg xmlns="'.concat(i,'">')),(new DOMParser).parseFromString(n,"image/svg+xml").documentElement)).firstChild}},Pt=function(t){var e=jt(t),n=document.createElementNS(i,"g"),r=e.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=e.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n},Et=function(t,e){var n=t.querySelector(".a9s-inner").cloneNode(!0);n.removeAttribute("class"),n.removeAttribute("xmlns");var r=n.outerHTML||(new XMLSerializer).serializeToString(n);return r=r.replace(' xmlns="'.concat(i,'"'),""),{source:null==e?void 0:e.src,selector:{type:"SvgSelector",value:"<svg>".concat(r,"</svg>")}}},At=function(t,e,n,r){t.setAttribute("cx",e),t.setAttribute("cy",n),t.setAttribute("r",r)},xt=function(t,e,n,r){var o=t.querySelector(".a9s-inner"),i=t.querySelector(".a9s-outer");At(o,e,n,r),At(i,e,n,r)},kt=function(t){var e=t.querySelector(".a9s-outer");return{cx:parseFloat(e.getAttribute("cx")),cy:parseFloat(e.getAttribute("cy")),r:parseFloat(e.getAttribute("r"))}};function Ct(t){return Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ct(t)}function Mt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_t(r.key),r)}}function Rt(t,e,n){return(e=_t(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _t(t){var e=function(t,e){if("object"!==Ct(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==Ct(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Ct(e)?e:String(e)}var Tt=function(){function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Rt(this,"redraw",(function(){var t=kt(r.circle),e=t.cx,n=t.cy,o=t.r,i=e+o>r.w?r.w-o:e,u=n+o>r.h?r.h-o:n+o;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(i," ").concat(u," a ").concat(o," ").concat(o," 0 1 1 1 0"))})),Rt(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=e.naturalWidth,this.h=e.naturalHeight,this.circle=n;var o=kt(this.circle),u=o.cx,a=o.cy,c=o.r,l=u+c>this.w?this.w-c:u,s=a+c>this.h?this.h-c:a+c;this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(l," ").concat(s," a ").concat(c," ").concat(c," 0 1 1 1 0"))}var e,n;return e=t,(n=[{key:"element",get:function(){return this.mask}}])&&Mt(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Gt(t){return Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gt(t)}function Dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Lt(r.key),r)}}function Nt(t,e,n){return(e=Lt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Lt(t){var e=function(t,e){if("object"!==Gt(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==Gt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Gt(e)?e:String(e)}var Ht=function(){function t(e,n,r,o){var u=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Nt(this,"dragTo",(function(t,e){var n=u.env.image,r=n.naturalWidth,o=n.naturalHeight;u.group.style.display=null;var i=t-u.anchor[0],a=e-u.anchor[1],c=Math.max(1,Math.pow(Math.pow(i,2)+Math.pow(a,2),.5)/2),l=u.anchor[0]+i/2,s=u.anchor[1]+a/2;l-c<0||l+c>r||s-c<0||s+c>o||(xt(u.circle,l,s,c),u.mask.redraw())})),Nt(this,"getBoundingClientRect",(function(){return u.circle.getBoundingClientRect()})),Nt(this,"toSelection",(function(){return new k(Et(u.group,u.env.image))})),Nt(this,"destroy",(function(){u.group.parentNode.removeChild(u.group),u.mask=null,u.circle=null,u.group=null})),this.anchor=[e,n],this.env=o,this.group=document.createElementNS(i,"g"),this.circle=function(t,e,n){var r=document.createElementNS(i,"g"),o=document.createElementNS(i,"circle"),u=document.createElementNS(i,"circle");return u.setAttribute("class","a9s-inner"),At(u,t,e,2),o.setAttribute("class","a9s-outer"),At(o,t,e,2),r.appendChild(o),r.appendChild(u),r}(e,n),this.circle.setAttribute("class","a9s-selection"),this.mask=new Tt(o.image,this.circle),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.circle),r.appendChild(this.group)}var e,n;return e=t,(n=[{key:"element",get:function(){return this.circle}}])&&Dt(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Bt(t){return function(t){if(Array.isArray(t))return Ut(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Ut(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ut(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ut(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Xt=/firefox/i.test(navigator.userAgent),qt=function(t,e,n,r,o){t.setAttribute("width",r),t.setAttribute("height",o),Xt?(t.setAttribute("x",0),t.setAttribute("y",0),t.setAttribute("transform","translate(".concat(e,", ").concat(n,")"))):(t.setAttribute("x",e),t.setAttribute("y",n))},Yt=function(t,e,n){if(!n)return t;var r=n.reduce((function(t,n){var r=n(e);if(!r)return t;if("string"==typeof r||r instanceof String)t.className=t.className?"".concat(t.className," ").concat(r):r;else if(r.nodeType===Node.ELEMENT_NODE)t.elements=t.elements?[].concat(Bt(t.elements),[r]):[r];else{var o=r.className,i=r.style,u=r.element;o&&(t.className=t.className?"".concat(t.className," ").concat(o):o),i&&(t.style=t.style?"".concat(t.style," ").concat(i):i),u&&(t.elements=t.elements?[].concat(Bt(t.elements),[u]):[u])}for(var a in r)r.hasOwnProperty(a)&&a.startsWith("data-")&&(t[a]=r[a]);return t}),{}),o=r.className,u=r.style,a=r.elements;if(o&&function(t,e){var n=function(t){var e=t.getAttribute("class");return e?new Set(e.split(" ")):new Set}(t);n.add(e),t.setAttribute("class",Array.from(n).join(" "))}(t,o),u){var c=t.querySelector(".a9s-outer"),l=t.querySelector(".a9s-inner");c&&l?(c.setAttribute("style","display:none"),l.setAttribute("style",u)):t.setAttribute("style",u)}for(var s in a&&a.forEach((function(e){return function(t,e){var n=e.getBBox(),r=n.x,o=n.y,u=n.width,a=n.height,c=document.createElementNS(i,"svg");c.setAttribute("class","a9s-formatter-el"),qt(c,r,o,u,a);var l=document.createElementNS(i,"g");l.appendChild(t),c.appendChild(l),e.append(c)}(e,t)})),r)r.hasOwnProperty(s)&&s.startsWith("data-")&&t.setAttribute(s,r[s])},Vt=function(t,e,n,r,o){var i=t.querySelector(".a9s-formatter-el");i&&qt(i,e,n,r,o)};function Ft(t){return Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ft(t)}function zt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,u,a=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return It(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?It(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function It(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Wt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,te(r.key),r)}}function $t(){return $t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Jt(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},$t.apply(this,arguments)}function Zt(t,e){return Zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Zt(t,e)}function Kt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Jt(t){return Jt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jt(t)}function Qt(t,e,n){return(e=te(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function te(t){var e=function(t,e){if("object"!==Ft(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==Ft(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Ft(e)?e:String(e)}var ee=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Zt(t,e)}(a,t);var e,n,r,o,u=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Jt(r);if(o){var n=Jt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ft(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Kt(t)}(this,t)});function a(t,e,n,r){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),Qt(Kt(o=u.call(this,t,e,n,r)),"setSize",(function(t,e,n){xt(o.circle,t,e,n),o.mask.redraw(),Vt(o.elementGroup,t,e,n,n);var r=zt(o.handles,4),i=r[0],u=r[1],a=r[2],c=r[3];o.setHandleXY(i,t,e-n),o.setHandleXY(u,t+n,e),o.setHandleXY(a,t,e+n),o.setHandleXY(c,t-n,e)})),Qt(Kt(o),"stretchCorners",(function(t,e,n){var r,i=o.getHandleXY(e),u=n.x,a=n.y,c=0,l=0;0==t||2==t?(u=i.x,l=a-i.y,r=Math.abs(l)/2):(a=i.y,c=u-i.x,r=Math.abs(c)/2);var s=c>0?i.x:u,f=l>0?i.y:a,p=s+Math.abs(c)/2,y=f+Math.abs(l)/2;if(xt(o.circle,p,y,r),o.mask.redraw(),Vt(o.elementGroup,p,y,r,r),0==t||2==t){var b=0,d=2;(0==t&&l>0||2==t&&l<0)&&(b=2,d=0),o.setHandleXY(o.handles[b],p,y-r),o.setHandleXY(o.handles[d],p,y+r),o.setHandleXY(o.handles[1],p+r,y),o.setHandleXY(o.handles[3],p-r,y)}else{var h=3,m=1;(1==t&&c>0||3==t&&c<0)&&(h=1,m=3),o.setHandleXY(o.handles[h],p+r,y),o.setHandleXY(o.handles[m],p-r,y),o.setHandleXY(o.handles[0],p,y-r),o.setHandleXY(o.handles[2],p,y+r)}})),Qt(Kt(o),"onGrab",(function(t){return function(e){o.grabbedElem=t;var n=o.getSVGPoint(e),r=kt(o.circle),i=r.cx,u=r.cy;o.grabbedAt={x:n.x-i,y:n.y-u}}})),Qt(Kt(o),"onMouseMove",(function(t){var e=function(t,e){return t<0?0:t>e?e:t};if(o.grabbedElem){var n=o.getSVGPoint(t);if(o.grabbedElem===o.circle){var r=kt(o.circle).r,i=o.env.image,u=i.naturalWidth,a=i.naturalHeight,c=Math.max(e(n.x-o.grabbedAt.x,u-r),r),l=Math.max(e(n.y-o.grabbedAt.y,a-r),r);o.setSize(c,l,r),o.emit("update",Et(o.circle,o.env.image))}else{var s=o.handles.indexOf(o.grabbedElem),f=s<2?o.handles[s+2]:o.handles[s-2];o.stretchCorners(s,f,n),o.emit("update",Et(o.circle,o.env.image))}}})),Qt(Kt(o),"onMouseUp",(function(){o.grabbedElem=null,o.grabbedAt=null})),Qt(Kt(o),"onScaleChanged",(function(t){return o.handles.map(o.scaleHandle)})),Qt(Kt(o),"updateState",(function(t){var e=jt(t),n=parseFloat(e.getAttribute("cx")),r=parseFloat(e.getAttribute("cy")),i=parseFloat(e.getAttribute("r"));o.setSize(n,r,i)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp),o.containerGroup=document.createElementNS(i,"g"),o.circle=Pt(t),o.circle.querySelector(".a9s-inner").addEventListener("mousedown",o.onGrab(o.circle)),o.mask=new Tt(r.image,o.circle),o.containerGroup.appendChild(o.mask.element),o.elementGroup=document.createElementNS(i,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.elementGroup.appendChild(o.circle);var c=kt(o.circle),l=c.cx,s=c.cy,f=c.r;return o.handles=[[l,s-f],[l+f,s],[l,s+f],[l-f,s]].map((function(t){var e=zt(t,2),n=e[0],r=e[1],i=o.drawHandle(n,r);return i.addEventListener("mousedown",o.onGrab(i)),o.elementGroup.appendChild(i),i})),o.containerGroup.appendChild(o.elementGroup),e.appendChild(o.containerGroup),Yt(o.circle,t,n.formatter),o.grabbedElem=null,o.grabbedAt=null,o}return e=a,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),$t(Jt(a.prototype),"destroy",this).call(this)}}])&&Wt(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(K);function ne(t){return ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ne(t)}function re(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ce(r.key),r)}}function oe(t,e){return oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},oe(t,e)}function ie(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ue(t){return ue=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ue(t)}function ae(t,e,n){return(e=ce(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ce(t){var e=function(t,e){if("object"!==ne(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==ne(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===ne(e)?e:String(e)}var le=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&oe(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ue(r);if(o){var n=ue(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===ne(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ie(t)}(this,t)});function u(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),ae(ie(r=i.call(this,t,e,n)),"startDrawing",(function(t,e){r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new Ht(t,e,r.g,r.env)})),ae(ie(r),"stop",(function(){r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),ae(ie(r),"onMouseMove",(function(t,e){return r.rubberband.dragTo(t,e)})),ae(ie(r),"onMouseUp",(function(){r.detachListeners(),r.started=!1;var t=r.rubberband.getBoundingClientRect(),e=t.width,n=t.height,o=r.config.minSelectionWidth||4,i=r.config.minSelectionHeight||4;if(e>=o&&n>=i){var u=r.rubberband.element;u.annotation=r.rubberband.toSelection(),r.emit("complete",u)}else r.emit("cancel");r.stop()})),ae(ie(r),"createEditableShape",(function(t){return new ee(t,r.g,r.config,r.env)})),r.rubberband=null,r}return e=u,(n=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&re(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(Y);le.identifier="circle",le.supports=function(t){var e,n=t.selector("SvgSelector");if(n)return null===(e=n.value)||void 0===e?void 0:e.match(/^<svg.*<circle/g)};var se=function(t,e,n,r,o){t.setAttribute("cx",e),t.setAttribute("cy",n),t.setAttribute("rx",r),t.setAttribute("ry",o)},fe=function(t,e,n,r,o){var i=t.querySelector(".a9s-inner"),u=t.querySelector(".a9s-outer");se(i,e,n,r,o),se(u,e,n,r,o)},pe=function(t){var e=t.querySelector(".a9s-outer");return{cx:parseFloat(e.getAttribute("cx")),cy:parseFloat(e.getAttribute("cy")),rx:parseFloat(e.getAttribute("rx")),ry:parseFloat(e.getAttribute("ry"))}};function ye(t){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ye(t)}function be(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,he(r.key),r)}}function de(t,e,n){return(e=he(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function he(t){var e=function(t,e){if("object"!==ye(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==ye(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===ye(e)?e:String(e)}var me=function(){function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),de(this,"redraw",(function(){var t=pe(r.ellipse),e=t.cx,n=t.cy,o=t.rx,i=t.ry,u=n+i;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(e," ").concat(u," a ").concat(o," ").concat(i," 0 1 1 1 0"))})),de(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=e.naturalWidth,this.h=e.naturalHeight,this.ellipse=n;var o=pe(this.ellipse),u=o.cx,a=o.cy,c=o.rx,l=o.ry,s=a+l;this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(u," ").concat(s," a ").concat(c," ").concat(l," 0 1 1 1 0"))}var e,n;return e=t,(n=[{key:"element",get:function(){return this.mask}}])&&be(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ve(t){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ve(t)}function ge(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Se(r.key),r)}}function we(t,e,n){return(e=Se(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Se(t){var e=function(t,e){if("object"!==ve(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==ve(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===ve(e)?e:String(e)}var Oe=function(){function t(e,n,r,o){var u=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),we(this,"dragTo",(function(t,e){u.group.style.display=null;var n=t-u.anchor[0],r=e-u.anchor[1],o=n>0?u.anchor[0]+n/2:t+n/2,i=r>0?u.anchor[1]+r/2:e+r/2,a=Math.abs(n/2),c=Math.abs(r/2);fe(u.ellipse,o,i,a,c),u.mask.redraw()})),we(this,"getBoundingClientRect",(function(){return u.ellipse.getBoundingClientRect()})),we(this,"toSelection",(function(){return new k(Et(u.group,u.env.image))})),we(this,"destroy",(function(){u.group.parentNode.removeChild(u.group),u.mask=null,u.ellipse=null,u.group=null})),this.anchor=[e,n],this.env=o,this.group=document.createElementNS(i,"g"),this.ellipse=function(t,e,n,r){var o=document.createElementNS(i,"g"),u=document.createElementNS(i,"ellipse"),a=document.createElementNS(i,"ellipse");return u.setAttribute("class","a9s-inner"),se(u,t,e,2,r),a.setAttribute("class","a9s-outer"),se(a,t,e,2,r),o.appendChild(a),o.appendChild(u),o}(e,n),this.ellipse.setAttribute("class","a9s-selection"),this.mask=new me(o.image,this.ellipse),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.ellipse),r.appendChild(this.group)}var e,n;return e=t,(n=[{key:"element",get:function(){return this.ellipse}}])&&ge(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function je(t){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},je(t)}function Pe(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,u,a=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Ee(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ee(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ee(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ae(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_e(r.key),r)}}function xe(){return xe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Me(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},xe.apply(this,arguments)}function ke(t,e){return ke=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ke(t,e)}function Ce(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Me(t){return Me=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Me(t)}function Re(t,e,n){return(e=_e(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _e(t){var e=function(t,e){if("object"!==je(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==je(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===je(e)?e:String(e)}var Te=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ke(t,e)}(a,t);var e,n,r,o,u=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Me(r);if(o){var n=Me(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===je(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ce(t)}(this,t)});function a(t,e,n,r){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),Re(Ce(o=u.call(this,t,e,n,r)),"setSize",(function(t,e,n,r){fe(o.ellipse,t,e,n,r),o.mask.redraw(),Vt(o.elementGroup,t,e,n,r);var i=Pe(o.handles,4),u=i[0],a=i[1],c=i[2],l=i[3];o.setHandleXY(u,t,e-r),o.setHandleXY(a,t+n,e),o.setHandleXY(c,t,e+r),o.setHandleXY(l,t-n,e)})),Re(Ce(o),"stretchCorners",(function(t,e,n,r){var i=o.getHandleXY(e),u=o.getHandleXY(n),a=r.x,c=r.y,l=0,s=0;0==t||2==t?a=i.x:c=i.y;var f=a-i.x,p=c-i.y,y=f>0?i.x:a,b=p>0?i.y:c,d=Math.abs(f),h=Math.abs(p),m=y+d/2,v=b+h/2;if(l=d/2,s=h/2,0==t||2==t?l=Math.abs(i.x-u.x):s=Math.abs(i.y-u.y),fe(o.ellipse,m,v,l,s),o.mask.redraw(),Vt(o.elementGroup,m,v,l,s),0==t||2==t){var g=0,w=2;(0==t&&p>0||2==t&&p<0)&&(g=2,w=0),o.setHandleXY(o.handles[g],m,v-s),o.setHandleXY(o.handles[w],m,v+s),o.setHandleXY(o.handles[1],m+l,v),o.setHandleXY(o.handles[3],m-l,v)}else{var S=3,O=1;(1==t&&f>0||3==t&&f<0)&&(S=1,O=3),o.setHandleXY(o.handles[S],m+l,v),o.setHandleXY(o.handles[O],m-l,v),o.setHandleXY(o.handles[0],m,v-s),o.setHandleXY(o.handles[2],m,v+s)}})),Re(Ce(o),"onGrab",(function(t){return function(e){o.grabbedElem=t;var n=o.getSVGPoint(e),r=pe(o.ellipse),i=r.cx,u=r.cy;o.grabbedAt={x:n.x-i,y:n.y-u}}})),Re(Ce(o),"onMouseMove",(function(t){var e=function(t,e){return t<0?0:t>e?e:t};if(o.grabbedElem){var n=o.getSVGPoint(t);if(o.grabbedElem===o.ellipse){var r=pe(o.ellipse),i=r.rx,u=r.ry,a=o.env.image,c=a.naturalWidth,l=a.naturalHeight,s=e(n.x-o.grabbedAt.x,c-i),f=e(n.y-o.grabbedAt.y,l-u);o.setSize(s,f,i,u),o.emit("update",Et(o.ellipse,o.env.image))}else{var p=o.handles.indexOf(o.grabbedElem),y=p<2?o.handles[p+2]:o.handles[p-2],b=o.handles[(p+3)%4];o.stretchCorners(p,y,b,n),o.emit("update",Et(o.ellipse,o.env.image))}}})),Re(Ce(o),"onMouseUp",(function(){o.grabbedElem=null,o.grabbedAt=null})),Re(Ce(o),"onScaleChanged",(function(t){return o.handles.map(o.scaleHandle)})),Re(Ce(o),"updateState",(function(t){var e=jt(t),n=parseFloat(e.getAttribute("cx")),r=parseFloat(e.getAttribute("cy")),i=parseFloat(e.getAttribute("rx")),u=parseFloat(e.getAttribute("ry"));o.setSize(n,r,i,u)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp),o.containerGroup=document.createElementNS(i,"g"),o.ellipse=Pt(t),o.ellipse.querySelector(".a9s-inner").addEventListener("mousedown",o.onGrab(o.ellipse)),o.mask=new me(r.image,o.ellipse),o.containerGroup.appendChild(o.mask.element),o.elementGroup=document.createElementNS(i,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.elementGroup.appendChild(o.ellipse);var c=pe(o.ellipse),l=c.cx,s=c.cy,f=c.rx,p=c.ry;return o.handles=[[l,s-p],[l+f,s],[l,s+p],[l-f,s]].map((function(t){var e=Pe(t,2),n=e[0],r=e[1],i=o.drawHandle(n,r);return i.addEventListener("mousedown",o.onGrab(i)),o.elementGroup.appendChild(i),i})),o.containerGroup.appendChild(o.elementGroup),e.appendChild(o.containerGroup),Yt(o.ellipse,t,n.formatter),o.grabbedElem=null,o.grabbedAt=null,o}return e=a,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),xe(Me(a.prototype),"destroy",this).call(this)}}])&&Ae(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(K);function Ge(t){return Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ge(t)}function De(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ue(r.key),r)}}function Ne(t,e){return Ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ne(t,e)}function Le(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function He(t){return He=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},He(t)}function Be(t,e,n){return(e=Ue(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ue(t){var e=function(t,e){if("object"!==Ge(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==Ge(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Ge(e)?e:String(e)}var Xe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ne(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=He(r);if(o){var n=He(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Ge(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Le(t)}(this,t)});function u(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),Be(Le(r=i.call(this,t,e,n)),"startDrawing",(function(t,e){r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new Oe(t,e,r.g,r.env)})),Be(Le(r),"stop",(function(){r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),Be(Le(r),"onMouseMove",(function(t,e){return r.rubberband.dragTo(t,e)})),Be(Le(r),"onMouseUp",(function(){r.detachListeners(),r.started=!1;var t=r.rubberband.getBoundingClientRect(),e=t.width,n=t.height,o=r.config.minSelectionWidth||4,i=r.config.minSelectionHeight||4;if(e>=o&&n>=i){var u=r.rubberband.element;u.annotation=r.rubberband.toSelection(),r.emit("complete",u)}else r.emit("cancel");r.stop()})),Be(Le(r),"createEditableShape",(function(t){return new Te(t,r.g,r.config,r.env)})),r.rubberband=null,r}return e=u,(n=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&De(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(Y);function qe(t){return qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qe(t)}function Ye(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ve(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ze(r.key),r)}}function Fe(t,e,n){return(e=ze(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ze(t){var e=function(t,e){if("object"!==qe(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==qe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===qe(e)?e:String(e)}Xe.identifier="ellipse",Xe.supports=function(t){var e,n=t.selector("SvgSelector");if(n)return null===(e=n.value)||void 0===e?void 0:e.match(/^<svg.*<ellipse/g)};var Ie=function(){function t(e,n,r){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Fe(this,"setPoints",(function(t){var e=t.map((function(t){return"L".concat(t[0]," ").concat(t[1])})).join(" ");e="M"+e.substring(1),o.outer.setAttribute("d",e),o.inner.setAttribute("d",e)})),Fe(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),Fe(this,"dragTo",(function(t){o.group.style.display=null,o.addPoint(t)})),Fe(this,"addPoint",(function(t){var e;o.points=[].concat(function(t){if(Array.isArray(t))return Ye(t)}(e=o.points)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return Ye(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ye(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[t]),o.setPoints(o.points)})),Fe(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.freehand=null,o.group=null})),Fe(this,"toSelection",(function(){return new k(Et(o.group,o.env.image))})),this.points=[e],this.env=r,this.group=document.createElementNS(i,"g"),this.freehand=document.createElementNS(i,"g"),this.freehand.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.freehand.appendChild(this.outer),this.freehand.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.freehand),n.appendChild(this.group)}var e,n;return e=t,(n=[{key:"element",get:function(){return this.freehand}}])&&Ve(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function We(t){return We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},We(t)}function $e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,en(r.key),r)}}function Ze(t,e){return Ze=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ze(t,e)}function Ke(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Je(){return Je="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Qe(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Je.apply(this,arguments)}function Qe(t){return Qe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Qe(t)}function tn(t,e,n){return(e=en(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function en(t){var e=function(t,e){if("object"!==We(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==We(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===We(e)?e:String(e)}var nn=function(t){var e=t.getAttribute("d").split("L"),n=[];if(e.length>0){var r=e[0].substring(1).trim().split(" ");n.push({x:parseFloat(r[0]),y:parseFloat(r[1])});for(var o=1;o<e.length;o++)r=e[o].trim().split(" "),n.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return n},rn=function(t){return t.querySelector(".a9s-inner").getBBox()},on=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ze(t,e)}(a,t);var e,n,r,o,u=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Qe(r);if(o){var n=Qe(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===We(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ke(t)}(this,t)});function a(t,e,n,r){var o,c;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),tn(Ke(c=u.call(this,t,e,n,r)),"setPoints",(function(t){var e=function(t){return Math.round(10*t)/10},n=t.map((function(t){return"L".concat(e(t.x)," ").concat(e(t.y))})).join(" ");n="M"+n.substring(1),c.shape.querySelector(".a9s-inner").setAttribute("d",n);var r=c.shape.querySelector(".a9s-outer");r.setAttribute("d",n);var o=r.getBBox(),i=o.x,u=o.y,a=o.width,l=o.height;Vt(c.elementGroup,i,u,a,l)})),tn(Ke(c),"onGrab",(function(t){return function(e){c.grabbedElem=t;var n=c.getSVGPoint(e);c.grabbedAt={x:n.x,y:n.y}}})),tn(Ke(c),"onMouseMove",(function(t){var e=function(t,e,n){return t+e<0?-t:t+e>n?n-t:e};if(c.grabbedElem){var n=c.getSVGPoint(t),r=rn(c.shape),o=r.x,i=r.y,u=r.width,a=r.height;if(c.grabbedElem===c.shape){var l=c.env.image,s=l.naturalWidth,f=l.naturalHeight,p=e(o,n.x-c.grabbedAt.x,s-u),y=e(i,n.y-c.grabbedAt.y,f-a),b=c.shape.querySelector(".a9s-inner"),d=nn(b).map((function(t){return{x:t.x+p,y:t.y+y}}));c.grabbedAt=n,c.setPoints(d),c.emit("update",Et(c.shape,c.env.image))}}})),tn(Ke(c),"onMouseUp",(function(t){c.grabbedElem=null,c.grabbedAt=null})),tn(Ke(c),"updateState",(function(t){var e=nn(jt(t));c.setPoints(e)})),tn(Ke(c),"destroy",(function(){c.containerGroup.parentNode.removeChild(c.containerGroup),Je((o=Ke(c),Qe(a.prototype)),"destroy",o).call(o)})),c.svg.addEventListener("mousemove",c.onMouseMove),c.svg.addEventListener("mouseup",c.onMouseUp),c.containerGroup=document.createElementNS(i,"g"),c.shape=Pt(t),c.elementGroup=document.createElementNS(i,"g"),c.elementGroup.setAttribute("class","a9s-annotation editable selected"),c.elementGroup.appendChild(c.shape),c.containerGroup.appendChild(c.elementGroup),e.appendChild(c.containerGroup),Yt(c.shape,t,n.formatter),c.shape.querySelector(".a9s-inner").addEventListener("mousedown",c.onGrab(c.shape));var l=rn(c.shape);return l.x,l.y,l.width,l.height,c.grabbedElem=null,c.grabbedAt=null,c}return e=a,(n=[{key:"element",get:function(){return this.elementGroup}}])&&$e(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(K);function un(t){return un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},un(t)}function an(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,pn(r.key),r)}}function cn(t,e){return cn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},cn(t,e)}function ln(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function sn(t){return sn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},sn(t)}function fn(t,e,n){return(e=pn(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pn(t){var e=function(t,e){if("object"!==un(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==un(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===un(e)?e:String(e)}var yn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cn(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=sn(r);if(o){var n=sn(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===un(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ln(t)}(this,t)});function u(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),fn(ln(r=i.call(this,t,e,n)),"startDrawing",(function(t,e){r._isDrawing=!0,r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp,dblClick:r.onDblClick}),r.rubberband=new Ie([t,e],r.g,r.env)})),fn(ln(r),"stop",(function(){r.detachListeners(),r._isDrawing=!1,r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),fn(ln(r),"onMouseMove",(function(t,e){return r.rubberband.dragTo([t,e])})),fn(ln(r),"onMouseUp",(function(t,e){r.onDblClick(t,e)})),fn(ln(r),"onDblClick",(function(t,e){r._isDrawing=!1,r.rubberband.addPoint([t,e]),r.detachListeners();var n=r.rubberband.getBoundingClientRect(),o=n.width,i=n.height,u=r.config.minSelectionWidth||4,a=r.config.minSelectionHeight||4;if(o>=u||i>=a){var c=r.rubberband.element;c.annotation=r.rubberband.toSelection(),r.emit("complete",c)}else r.emit("cancel");r.stop()})),fn(ln(r),"createEditableShape",(function(t){return new on(t,r.g,r.config,r.env)})),r._isDrawing=!1,r}return e=u,(n=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&an(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(Y);function bn(t){return bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bn(t)}function dn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,mn(r.key),r)}}function hn(t,e,n){return(e=mn(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function mn(t){var e=function(t,e){if("object"!==bn(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==bn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===bn(e)?e:String(e)}yn.identifier="freehand",yn.supports=function(t){var e=t.selector("SvgSelector");if(e)return e.value.match(/^<svg.*<path*/g)&&!e.value.toUpperCase().includes("Z")};var vn=function(){function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),hn(this,"redraw",(function(){r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(r.polygon.getAttribute("points")," z"))})),hn(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=e.naturalWidth,this.h=e.naturalHeight,this.polygon=n,this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(this.polygon.getAttribute("points")," z"))}var e,n;return e=t,(n=[{key:"element",get:function(){return this.mask}}])&&dn(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function gn(t){return gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gn(t)}function wn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Sn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?wn(Object(n),!0).forEach((function(e){xn(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function On(t){return function(t){if(Array.isArray(t))return En(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Pn(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jn(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Pn(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return u=t.done,t},e:function(t){a=!0,i=t},f:function(){try{u||null==n.return||n.return()}finally{if(a)throw i}}}}function Pn(t,e){if(t){if("string"==typeof t)return En(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?En(t,e):void 0}}function En(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function An(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,kn(r.key),r)}}function xn(t,e,n){return(e=kn(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function kn(t){var e=function(t,e){if("object"!==gn(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==gn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===gn(e)?e:String(e)}var Cn=function(){function t(e,n,r){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),xn(this,"setPoints",(function(t){var e,n="",r=jn(t);try{for(r.s();!(e=r.n()).done;){var i=e.value,u="";if(i.length>0){var a,c=jn(i);try{for(c.s();!(a=c.n()).done;){var l=a.value;l&&(u+=""===u?"M".concat(l[0],",").concat(l[1]):" L".concat(l[0],",").concat(l[1]))}}catch(t){c.e(t)}finally{c.f()}n+=u}}}catch(t){r.e(t)}finally{r.f()}n+=" Z",o.outer.setAttribute("d",n),o.inner.setAttribute("d",n)})),xn(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),xn(this,"dragTo",(function(t){o.group.style.display=null;var e=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=o.points.slice(0,-1),r=[].concat(On(e),[t,e[0]]);n.push(r),o.setPoints(n),o.mask.redraw()})),xn(this,"addPoint",(function(t){if(o.points[o.points.length-1].length>0){var e=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=e[e.length-1];Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2)>4&&(o.points[o.points.length-1]=[].concat(On(e),[t,e[0]]),o.setPoints(o.points),o.mask.redraw())}else o.points[o.points.length-1]=[t,t],o.setPoints(o.points)})),xn(this,"undo",(function(){o.points[o.points.length-1].length>2?o.points[o.points.length-1].pop():o.points.length>1&&o.points.pop()})),xn(this,"newPart",(function(){o.points.push([])})),xn(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.multipolygon=null,o.group=null})),xn(this,"toSelection",(function(){return new k(Sn(Sn({},Et(o.group,o.env.image)),{},{renderedVia:{name:"multipolygon"}}))})),this.points=[],this.points.push([e,e]),this.env=r,this.group=document.createElementNS(i,"g"),this.multipolygon=document.createElementNS(i,"g"),this.multipolygon.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.mask=new vn(r.image,this.inner),this.multipolygon.appendChild(this.outer),this.multipolygon.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.multipolygon),n.appendChild(this.group)}var e,n;return e=t,(n=[{key:"element",get:function(){return this.multipolygon}}])&&An(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Mn(t){return Mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mn(t)}function Rn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function _n(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Rn(Object(n),!0).forEach((function(e){Hn(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Rn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Tn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Bn(r.key),r)}}function Gn(t,e){return Gn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Gn(t,e)}function Dn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Nn(){return Nn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ln(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},Nn.apply(this,arguments)}function Ln(t){return Ln=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ln(t)}function Hn(t,e,n){return(e=Bn(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Bn(t){var e=function(t,e){if("object"!==Mn(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==Mn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Mn(e)?e:String(e)}function Un(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Xn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return u=t.done,t},e:function(t){a=!0,i=t},f:function(){try{u||null==n.return||n.return()}finally{if(a)throw i}}}}function Xn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var qn=function(t){var e,n=[],r=Un(Yn(t.querySelector(".a9s-inner").attributes.d.nodeValue));try{for(r.s();!(e=r.n()).done;){var o,i=e.value,u=[],a=Un(i);try{for(a.s();!(o=a.n()).done;){var c=o.value,l={x:parseFloat(c[0]),y:parseFloat(c[1])};u.push(l)}}catch(t){a.e(t)}finally{a.f()}n.push(u)}}catch(t){r.e(t)}finally{r.f()}return n},Yn=function(t){var e=t.split("M"),n=[];return e.forEach((function(t,e){if(t.length>0){var r=[];(t=(t=(t=(t=(t=t.replace(/ Z/g,"Z")).replace(/Z /g,"Z")).replace(/Z/g,"")).replace(/L /g,"L")).replace(/ L/g,"L")).split("L").forEach((function(t,e){r.push([parseFloat(t.split(",")[0]).toFixed(2).toString(),parseFloat(t.split(",")[1]).toFixed(2).toString()])})),r[0]!==r[r.length-1]&&r.push(r[0]),n.push(r)}})),n},Vn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gn(t,e)}(a,t);var e,n,r,o,u=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ln(r);if(o){var n=Ln(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Mn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Dn(t)}(this,t)});function a(t,e,n,r){var o,c;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),Hn(Dn(c=u.call(this,t,e,n,r)),"setPoints",(function(t){var e,n=function(t){return Math.round(10*t)/10},r="",o=Un(t);try{for(o.s();!(e=o.n()).done;){var i=e.value;r+="M";var u,a=!0,l=Un(i);try{for(l.s();!(u=l.n()).done;){var s=u.value;a?(a=!1,r+=s.x.toString()+","+s.y.toString()):r+=" L"+n(s.x).toString()+","+n(s.y).toString()}}catch(t){l.e(t)}finally{l.f()}r+=" Z"}}catch(t){o.e(t)}finally{o.f()}c.shape.querySelector(".a9s-inner").setAttribute("d",r);var f=c.shape.querySelector(".a9s-outer");f.setAttribute("d",r);var p=f.getBBox(),y=p.x,b=p.y,d=p.width,h=p.height;Vt(c.elementGroup,y,b,d,h)})),Hn(Dn(c),"onGrab",(function(t){return function(e){c.grabbedElem=t;var n=c.getSVGPoint(e);c.grabbedAt={x:n.x,y:n.y}}})),Hn(Dn(c),"onMouseMove",(function(t){if(c.grabbedElem){var e=c.getSVGPoint(t);if(c.grabbedElem===c.shape){var n,r=e.x-c.grabbedAt.x,o=e.y-c.grabbedAt.y,i=[],u=Un(qn(c.shape));try{for(u.s();!(n=u.n()).done;){var a=n.value;i.push(a.map((function(t){return{x:t.x+r,y:t.y+o}})))}}catch(t){u.e(t)}finally{u.f()}c.grabbedAt=e,c.setPoints(i);for(var l=0,s=0,f=i;s<f.length;s++)f[s].forEach((function(t,e){void 0!==c.handles[l][e]&&c.setHandleXY(c.handles[l][e],t.x,t.y)})),l+=1;c.emit("update",_n(_n({},Et(c.shape,c.env.image)),{},{renderedVia:{name:"multipolygon"}}))}else{var p,y=-1,b=0,d=!1,h=Un(c.handles);try{for(h.s();!(p=h.n()).done;){var m=p.value;m.indexOf(c.grabbedElem)>0?(y=m.indexOf(c.grabbedElem),d=!0):d||(b+=1)}}catch(t){h.e(t)}finally{h.f()}var v,g=qn(c.shape),w=[],S=0,O=Un(g);try{var j=function(){var t=v.value;if(S===b){var n=[];t.forEach((function(t,r){r===y?n.push(e):n.push(t)})),w.push(n)}else w.push(t);S+=1};for(O.s();!(v=O.n()).done;)j()}catch(t){O.e(t)}finally{O.f()}c.setPoints(w),S=0;var P,E=Un(c.handles);try{for(E.s();!(P=E.n()).done;){var A=P.value;S===b&&c.setHandleXY(A[y],e.x,e.y),S+=1}}catch(t){E.e(t)}finally{E.f()}c.emit("update",_n(_n({},Et(c.shape,c.env.image)),{},{renderedVia:{name:"multipolygon"}}))}}})),Hn(Dn(c),"onMouseUp",(function(t){c.grabbedElem=null,c.grabbedAt=null})),Hn(Dn(c),"updateState",(function(t){var e=qn(jt(t));c.setPoints(e)})),Hn(Dn(c),"destroy",(function(){c.containerGroup.parentNode.removeChild(c.containerGroup),Nn((o=Dn(c),Ln(a.prototype)),"destroy",o).call(o)})),c.svg.addEventListener("mousemove",c.onMouseMove),c.svg.addEventListener("mouseup",c.onMouseUp),c.containerGroup=document.createElementNS(i,"g"),c.shape=function(t){var e=jt(t);!function(t){var e=jt(t).getAttribute("d");Yn(e)}(t);var n=document.createElementNS(i,"g"),r=e.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=e.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n}(t),c.elementGroup=document.createElementNS(i,"g"),c.elementGroup.setAttribute("class","a9s-annotation editable selected"),c.elementGroup.appendChild(c.shape);var l=qn(c.shape);c.handles=[];var s,f=Un(l);try{for(f.s();!(s=f.n()).done;){var p=s.value;c.handles.push(p.map((function(t){var e=c.drawHandle(t.x,t.y);return e.addEventListener("mousedown",c.onGrab(e)),c.elementGroup.appendChild(e),e})))}}catch(t){f.e(t)}finally{f.f()}c.containerGroup.appendChild(c.elementGroup),e.appendChild(c.containerGroup),Yt(c.shape,t,n.formatter),c.shape.querySelector(".a9s-inner").addEventListener("mousedown",c.onGrab(c.shape));var y=c.shape.querySelector(".a9s-inner").getBBox();return y.x,y.y,y.width,y.height,c.grabbedElem=null,c.grabbedAt=null,c}return e=a,(n=[{key:"element",get:function(){return this.elementGroup}}])&&Tn(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(K);function Fn(t){return Fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fn(t)}function zn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Kn(r.key),r)}}function In(t,e){return In=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},In(t,e)}function Wn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function $n(t){return $n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$n(t)}function Zn(t,e,n){return(e=Kn(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Kn(t){var e=function(t,e){if("object"!==Fn(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==Fn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Fn(e)?e:String(e)}var Jn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&In(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$n(r);if(o){var n=$n(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===Fn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Wn(t)}(this,t)});function u(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),Zn(Wn(r=i.call(this,t,e,n)),"startDrawing",(function(t,e){r._isDrawing=!0,r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp,dblClick:r.onDblClick}),r.rubberband=new Cn([t,e],r.g,r.env)})),Zn(Wn(r),"stop",(function(){r.detachListeners(),r._isDrawing=!1,r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),Zn(Wn(r),"undo",(function(){r.rubberband&&r.rubberband.undo()})),Zn(Wn(r),"newPart",(function(){r.rubberband&&r.rubberband.newPart()})),Zn(Wn(r),"onMouseMove",(function(t,e){return r.rubberband.dragTo([t,e])})),Zn(Wn(r),"onMouseUp",(function(t,e,n){if(n.altKey)r.onDblClick(n);else if(n.ctrlKey)r.rubberband.undo();else{var o=r.rubberband.getBoundingClientRect(),i=o.width,u=o.height,a=r.config.minSelectionWidth||4,c=r.config.minSelectionHeight||4;i>=a||u>=c?r.rubberband.addPoint([t,e]):(r.emit("cancel"),r.stop())}})),Zn(Wn(r),"onDblClick",(function(t,e){r._isDrawing=!1,r.rubberband.addPoint([t,e]);var n=r.rubberband.element;n.annotation=r.rubberband.toSelection(),r.emit("complete",n),r.stop()})),Zn(Wn(r),"createEditableShape",(function(t){return new Vn(t,r.g,r.config,r.env)})),r._isDrawing=!1,document.addEventListener("keydown",(function(t){"z"==t.key&&t.ctrlKey&&r.undo(),"n"==t.key&&r.newPart()})),r}return e=u,(n=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&zn(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(Y);function Qn(t){return Qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qn(t)}function tr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,nr(r.key),r)}}function er(t,e,n){return(e=nr(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function nr(t){var e=function(t,e){if("object"!==Qn(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==Qn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===Qn(e)?e:String(e)}Jn.identifier="multipolygon",Jn.supports=function(t){return!1};var rr=function(){function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),er(this,"redraw",(function(){r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(r.line.getAttribute("x1")," ").concat(r.line.getAttribute("y1")," ").concat(r.line.getAttribute("x2")," ").concat(r.line.getAttribute("y2"),"z"))})),er(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=e.naturalWidth,this.h=e.naturalHeight,this.line=n,this.mask=document.createElementNS(i,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(this.line.getAttribute("x1")," ").concat(this.line.getAttribute("y1")," z"))}var e,n;return e=t,(n=[{key:"element",get:function(){return this.mask}}])&&tr(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function or(t){return or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},or(t)}function ir(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ur(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ir(Object(n),!0).forEach((function(e){lr(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ir(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ar(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function cr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,sr(r.key),r)}}function lr(t,e,n){return(e=sr(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function sr(t){var e=function(t,e){if("object"!==or(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==or(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===or(e)?e:String(e)}var fr=function(){function t(e,n,r){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),lr(this,"setPoints",(function(t){var e=t;o.outer.setAttribute("x1",e[0]),o.inner.setAttribute("x1",e[0]),o.outer.setAttribute("y1",e[1]),o.inner.setAttribute("y1",e[1]),e.length>2&&(o.outer.setAttribute("x2",e[2]),o.inner.setAttribute("x2",e[2]),o.outer.setAttribute("y2",e[3]),o.inner.setAttribute("y2",e[3]))})),lr(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),lr(this,"dragTo",(function(t){o.group.style.display=null,o.mousepos=t;var e,n=[].concat(function(t){if(Array.isArray(t))return ar(t)}(e=o.points)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return ar(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ar(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[t[0],t[1]]);o.setPoints(n),o.mask.redraw()})),lr(this,"addPoint",(function(t){o.points.length<=2&&(o.points[2]=t[0],o.points[3]=t[1],o.setPoints(o.points))})),lr(this,"undo",(function(){o.points[o.points.length-1].length>2?o.points[o.points.length-1].pop():o.points.length>1&&o.points.pop()})),lr(this,"newPart",(function(){o.points.push([])})),lr(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.Line=null,o.group=null})),lr(this,"toSelection",(function(){return new k(ur(ur({},Et(o.group,o.env.image)),{},{renderedVia:{name:"line"}}))})),this.points=e,this.env=r,this.group=document.createElementNS(i,"g"),this.Line=document.createElementNS(i,"g"),this.Line.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(i,"line"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(i,"line"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.mask=new rr(r.image,this.inner),this.Line.appendChild(this.outer),this.Line.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.Line),n.appendChild(this.group)}var e,n;return e=t,(n=[{key:"element",get:function(){return this.Line}}])&&cr(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function pr(t){return pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pr(t)}function yr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function br(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,wr(r.key),r)}}function dr(t,e){return dr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},dr(t,e)}function hr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function mr(){return mr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=vr(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},mr.apply(this,arguments)}function vr(t){return vr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vr(t)}function gr(t,e,n){return(e=wr(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function wr(t){var e=function(t,e){if("object"!==pr(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==pr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===pr(e)?e:String(e)}var Sr=function(t){var e=t.querySelector(".a9s-inner");return[[e.x1.baseVal,e.y1.baseVal],[e.x2.baseVal,e.y2.baseVal]]},Or=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&dr(t,e)}(a,t);var e,n,r,o,u=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=vr(r);if(o){var n=vr(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===pr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return hr(t)}(this,t)});function a(t,e,n,r){var o,c;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),gr(hr(c=u.call(this,t,e,n,r)),"onScaleChanged",(function(){return c.handles.map(c.scaleHandle)})),gr(hr(c),"setPoints",(function(t){var e=t[0].x,n=t[0].y,r=t[1].x,o=t[1].y,i=c.shape.querySelector(".a9s-inner");i.setAttribute("x1",e),i.setAttribute("y1",n),i.setAttribute("x2",r),i.setAttribute("y2",o);var u=c.shape.querySelector(".a9s-outer");u.setAttribute("x1",e),u.setAttribute("y1",n),u.setAttribute("x2",r),u.setAttribute("y2",o),c.mask.redraw();var a=u.getBBox(),l=a.x,s=a.y,f=a.width,p=a.height;Vt(c.elementGroup,l,s,f,p)})),gr(hr(c),"onGrab",(function(t){return function(e){0===e.button&&(c.grabbedElem=t,c.grabbedAt=c.getSVGPoint(e))}})),gr(hr(c),"onMouseMove",(function(t){var e=function(t,e,n){return t+e<0?-t:t+e>n?n-t:e};if(c.grabbedElem){var n=c.getSVGPoint(t);if(c.grabbedElem===c.shape){var r=c.shape.querySelector(".a9s-inner").getBBox(),o=r.x,i=r.y,u=r.width,a=r.height,l=c.env.image,s=l.naturalWidth,f=l.naturalHeight,p=e(o,n.x-c.grabbedAt.x,s-u),y=e(i,n.y-c.grabbedAt.y,f-a),b=Sr(c.shape).map((function(t){return{x:t[0].value+p,y:t[1].value+y}}));c.grabbedAt=n,c.setPoints(b),b.forEach((function(t,e){return c.setHandleXY(c.handles[e],t.x,t.y)})),c.emit("update",Et(c.shape,c.env.image))}else{var d=c.handles.indexOf(c.grabbedElem),h=Sr(c.shape).map((function(t,e){return e===d?n:{x:t[0].value,y:t[1].value}}));c.setPoints(h),c.setHandleXY(c.handles[d],n.x,n.y),c.emit("update",Et(c.shape,c.env.image))}}})),gr(hr(c),"onMouseUp",(function(t){c.grabbedElem=null,c.grabbedAt=null})),gr(hr(c),"updateState",(function(t){var e=jt(t).getAttribute("points").split(" ").map((function(t){var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,u,a=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return yr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yr(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.split(",").map((function(t){return parseFloat(t.trim())})),2);return{x:e[0],y:e[1]}}));c.setPoints(e),e.forEach((function(t,e){return c.setHandleXY(c.handles[e],t.x,t.y)}))})),gr(hr(c),"destroy",(function(){c.containerGroup.parentNode.removeChild(c.containerGroup),mr((o=hr(c),vr(a.prototype)),"destroy",o).call(o)})),c.svg.addEventListener("mousemove",c.onMouseMove),c.svg.addEventListener("mouseup",c.onMouseUp),c.containerGroup=document.createElementNS(i,"g"),c.shape=Pt(t),c.shape.querySelector(".a9s-inner").addEventListener("mousedown",c.onGrab(c.shape)),c.mask=new rr(r.image,c.shape.querySelector(".a9s-inner")),c.containerGroup.appendChild(c.mask.element),c.elementGroup=document.createElementNS(i,"g"),c.elementGroup.setAttribute("class","a9s-annotation editable selected"),c.elementGroup.setAttribute("data-id",t.id),c.elementGroup.appendChild(c.shape),c.handles=Sr(c.shape).map((function(t){var e=c.drawHandle(t[0].value,t[1].value);return e.addEventListener("mousedown",c.onGrab(e)),c.elementGroup.appendChild(e),e})),c.containerGroup.appendChild(c.elementGroup),e.appendChild(c.containerGroup),Yt(c.shape,t,n.formatters),c.grabbedElem=null,c.grabbedAt=null,c}return e=a,(n=[{key:"element",get:function(){return this.elementGroup}}])&&br(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(K);function jr(t){return jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jr(t)}function Pr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Cr(r.key),r)}}function Er(t,e){return Er=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Er(t,e)}function Ar(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function xr(t){return xr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},xr(t)}function kr(t,e,n){return(e=Cr(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Cr(t){var e=function(t,e){if("object"!==jr(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==jr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===jr(e)?e:String(e)}var Mr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Er(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=xr(r);if(o){var n=xr(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===jr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ar(t)}(this,t)});function u(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),kr(Ar(r=i.call(this,t,e,n)),"startDrawing",(function(t,e){r._isDrawing=!0,r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new fr([t,e],r.g,r.env)})),kr(Ar(r),"stop",(function(){r.detachListeners(),r._isDrawing=!1,r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),kr(Ar(r),"undo",(function(){r.rubberband&&r.rubberband.undo()})),kr(Ar(r),"newPart",(function(){r.rubberband&&r.rubberband.newPart()})),kr(Ar(r),"onMouseMove",(function(t,e){return r.rubberband.dragTo([t,e])})),kr(Ar(r),"onMouseUp",(function(t,e,n){if(n.altKey)r.onDblClick(n);else if(n.ctrlKey)r.rubberband.undo();else if(2==r.rubberband.points.length)if(r.rubberband.addPoint([t,e]),r.rubberband.points[0]==r.rubberband.points[2]&&r.rubberband.points[1]==r.rubberband.points[3])r.emit("cancel"),r.stop();else{r._isDrawing=!1;var o=r.rubberband.element;o.annotation=r.rubberband.toSelection(),r.emit("complete",o),r.stop()}})),kr(Ar(r),"createEditableShape",(function(t){return new Or(t,r.g,r.config,r.env)})),r._isDrawing=!1,document.addEventListener("keydown",(function(t){"z"==t.key&&t.ctrlKey&&r.undo(),"n"==t.key&&r.newPart()})),r}return e=u,(n=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&Pr(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(Y);Mr.identifier="line",Mr.supports=function(t){var e,n=t.selector("SvgSelector");if(n)return null===(e=n.value)||void 0===e?void 0:e.match(/^<svg.*<line/g)};var Rr=new Set(["point","circle","ellipse","freehand","line"]);const _r=function(t,e){(null!=e&&e.tools?e.tools.map((function(t){return t.toLowerCase()})):Rr).forEach((function(e){"point"===e&&t.addDrawingTool(St),"circle"===e&&t.addDrawingTool(le),"ellipse"===e&&t.addDrawingTool(Xe),"freehand"===e&&t.addDrawingTool(yn),"multipolygon"===e&&t.addDrawingTool(Jn),"line"===e&&t.addDrawingTool(Mr)}))}})(),r.default})()));
//# sourceMappingURL=annotorious-selector-pack.js.map